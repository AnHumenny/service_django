{% extends "index/base.html" %}
{% block content %}
<div class="grp-wrapper">
    <div class="main-table" style="display: grid; grid-template-columns: 40% 60%; align-items: start;">
        <div class="data-section">
            <div class="main-table data-table">
                {% for index in page_obj %}
                <div class="table-string data-row">
                    <div class="content-table table-item data-item" style="min-width: 150px;">{{ index.date_created|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">
                        <a class="nav-link" href="{% url 'index-detail' index.id %}">{{ index.title|safe }}</a>
                    </div>
                </div>
                {% endfor %}
                <div class="pagination">
                    <div class="step-links">
                        {% if page_obj.has_previous %}
                            <a href="?page=1">&laquo; В начало</a> |
                            <a href="?page={{ page_obj.previous_page_number }}">Предыдущая страница</a>
                        {% endif %}
                        <span class="current">
                            страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }} |
                        </span>
                        {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}">Следующая страница</a> |
                            <a href="?page={{ page_obj.paginator.num_pages }}">В конец &raquo;</a>
                        {% endif %}
                    </div>
                </div>
                <div class="table-string header-row">
                    <div class="title-table table-item header-item" style="grid-column: span 2;">Статистика на текущий год</div>
                </div>
                <div class="chart-section">
                    <div class="chart-container_main">
                        <canvas id="myPolarAreaChart"></canvas>
                    </div>
                </div>
<!--                Секцию заблокировать до заполнения материалов и организаций-->
                <div class="table-string data-row">
                    <div class="content-table table-item data-item" style="grid-column: span 2;">
                        Остаток по кабелю utp 5e на {{ current_date|safe }} | {{ total|safe }} метров<br>
                        Расширение FTTX: {{ res_expansion|safe }} метров<br>
                        Монтаж точек WTTX {{ res_expansion_wttx|safe }} метров
                    </div>
                </div>
                {% for row in result_cable %}
                <div class="table-string data-row">
                    <div class="content-table table-item data-item" style="grid-column: span 2;">
                        FTTX | город: {{ row.city|safe }} | год: {{ row.month|date:"Y : M"|safe }} | использовано {{ row.total_amount|safe }} метров utp 5e
                    </div>
                </div>
                <!--        ...        -->
                {% endfor %}
            </div>
        </div>
        <div class="data-section">
            <div class="main-table data-table">
                {% for fttx in data_list %}
                <div class="table-string data-row">
                    <div class="content-table table-item data-item">{{ fttx.id|safe }}</div>
                    <div class="content-table table-item data-item">{{ fttx.reestr|safe }}</div>
                    <div class="content-table table-item data-item">{{ fttx.date_created|date:'Y-m-d' }}</div>
                    <div class="content-table table-item data-item">{{ fttx.city|safe }}</div>
                    <div class="content-table table-item data-item">{{ fttx.street|safe }}</div>
                    <div class="content-table table-item data-item">{{ fttx.home|safe }}</div>
                    <div class="content-table table-item data-item">{{ fttx.apartment|safe }}</div>
                    <div class="content-table table-item data-item">{{ fttx.name|safe }}</div>
<!--                    <div class="content-table table-item data-item">{{ fttx.organization__name|safe }}</div>-->
                </div>
                {% endfor %}
            </div>
            <div class="main-table data-table">
                <div class="table-string header-row">
                    <div class="title-table table-item header-item" style="grid-column: span 8;">Открытые инциденты</div>
                </div>
                <div class="table-string header-row">
                    <div class="title-table table-item header-item">ID</div>
                    <div class="title-table table-item header-item">Номер</div>
                    <div class="title-table table-item header-item">Дата открытия</div>
                    <div class="title-table table-item header-item">Дата закрытия</div>
                    <div class="title-table table-item header-item">Город</div>
                    <div class="title-table table-item header-item">Адрес</div>
                    <div class="title-table table-item header-item">Организация</div>
                    <div class="title-table table-item header-item">Статус</div>
                </div>
                {% for inc in accident %}
                <div class="table-string data-row">
                    <div class="content-table table-item data-item">{{ inc.id|safe }}</div>
                    <div class="content-table table-item data-item">
                        <a class="nav-link" href="{% url 'accident-detail' inc.id %}">{{ inc.number|safe }}</a>
                    </div>
                    <div class="content-table table-item data-item">{{ inc.datetime_open|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">{{ inc.datetime_close|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">{{ inc.city|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.address|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.organization|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.status|safe }}</div>
                </div>
                {% endfor %}
                <div class="pagination">
                    <div class="step-links">
                        {% if accident.has_previous %}
                            <a href="?pag=1">&laquo;&laquo;&laquo;</a> |
                            <a href="?pag={{ accident.previous_page_number }}">Предыдущая</a>
                        {% endif %}
                        <span class="current">
                            страница {{ accident.number }} из {{ accident.paginator.num_pages }} |
                        </span>
                        {% if accident.has_next %}
                            <a href="?pag={{ accident.next_page_number }}">Следующая</a> |
                            <a href="?pag={{ accident.paginator.num_pages }}">&raquo;&raquo;&raquo;</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="main-table data-table">
                <div class="table-string header-row">
                    <div class="title-table table-item header-item" style="grid-column: span 8;">Инциденты в статусе проверки</div>
                </div>
                <div class="table-string header-row">
                    <div class="title-table table-item header-item">ID</div>
                    <div class="title-table table-item header-item">Номер</div>
                    <div class="title-table table-item header-item">Дата открытия</div>
                    <div class="title-table table-item header-item">Дата закрытия</div>
                    <div class="title-table table-item header-item">Город</div>
                    <div class="title-table table-item header-item">Адрес</div>
                    <div class="title-table table-item header-item">Организация</div>
                    <div class="title-table table-item header-item">Статус</div>
                </div>
                {% for inc in check %}
                <div class="table-string data-row">
                    <div class="content-table table-item data-item">{{ inc.id|safe }}</div>
                    <div class="content-table table-item data-item">
                        <a class="nav-link" href="{% url 'accident-detail' inc.id %}">{{ inc.number|safe }}</a>
                    </div>
                    <div class="content-table table-item data-item">{{ inc.datetime_open|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">{{ inc.datetime_close|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">{{ inc.city|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.address|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.organization|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.status|safe }}</div>
                </div>
                {% endfor %}
                <div class="pagination">
                    <div class="step-links">
                        {% if check.has_previous %}
                            <a href="?pag=1">&laquo;&laquo;&laquo;</a> |
                            <a href="?pag={{ check.previous_page_number }}">Предыдущая</a>
                        {% endif %}
                        <span class="current">
                            страница {{ check.number }} из {{ check.paginator.num_pages }} |
                        </span>
                        {% if check.has_next %}
                            <a href="?pag={{ check.next_page_number }}">Следующая</a> |
                            <a href="?pag={{ check.paginator.num_pages }}">&raquo;&raquo;&raquo;</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="main-table data-table">
                <div class="table-string header-row">
                    <div class="title-table table-item header-item" style="grid-column: span 8;">Последние закрытые инциденты</div>
                </div>
                <div class="table-string header-row">
                    <div class="title-table table-item header-item">ID</div>
                    <div class="title-table table-item header-item">Номер</div>
                    <div class="title-table table-item header-item">Дата открытия</div>
                    <div class="title-table table-item header-item">Дата закрытия</div>
                    <div class="title-table table-item header-item">Город</div>
                    <div class="title-table table-item header-item">Адрес</div>
                    <div class="title-table table-item header-item">Организация</div>
                    <div class="title-table table-item header-item">Статус</div>
                </div>
                {% for inc in close %}
                <div class="table-string data-row">
                    <div class="content-table table-item data-item">{{ inc.id|safe }}</div>
                    <div class="content-table table-item data-item">
                        <a class="nav-link" href="{% url 'accident-detail' inc.id %}">{{ inc.number|safe }}</a>
                    </div>
                    <div class="content-table table-item data-item">{{ inc.datetime_open|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">{{ inc.datetime_close|date:'Y-m-d H:i' }}</div>
                    <div class="content-table table-item data-item">{{ inc.city|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.address|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.organization|safe }}</div>
                    <div class="content-table table-item data-item">{{ inc.status|safe }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('myPolarAreaChart').getContext('2d');
        const myPolarAreaChart = new Chart(ctx, {
            type: 'polarArea',
            data: {
                labels: ['январь', 'февраль', 'март', 'апрель', 'май', 'июнь',
                         'июль', 'август', 'сентябрь', 'октябрь', 'ноябрь', 'декабрь'],
                datasets: [{
                    label: 'Графика fttx на текущий год',
                    data: {{ date|safe }},
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.6)',
                        'rgba(75, 192, 192, 0.6)',
                        'rgba(255, 205, 86, 0.6)',
                        'rgba(255,255,0, 0.6)',
                        'rgba(0,255,0, 0.6)',
                        'rgba(148,0,211, 0.6)',
                        'rgba(205,133,63, 0.6)',
                        'rgba(102,205,170, 0.6)',
                        'rgba(95,158,160, 0.6)',
                        'rgba(192,192,192, 0.6)',
                        'rgba(255,0,255, 0.6)',
                        'rgba(255,160,122, 0.6)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 205, 86, 1)',
                        'rgba(255,255,0, 1)',
                        'rgba(0,255,0, 1)',
                        'rgba(148,0,211, 1)',
                        'rgba(205,133,63, 1)',
                        'rgba(102,205,170, 1)',
                        'rgba(95,158,160, 1)',
                        'rgba(192,192,192, 1)',
                        'rgba(255,0,255, 1)',
                        'rgba(255,160,122, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    r: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script>
{% endblock %}